<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<!-- 
Versions
	M2019-11-18 : add display of Julian calendar date 
	M2019-12-14 : 
		add handling and display of all date formatting options
		reorganize fields, avoid a free-text field as first field of any form
	M2019-12-24
		add systematic display of Unicode ISO (Gregorian) string
	M2020-01-11
		Adapt to flexible layout
-->
<html lang="fr">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="content-type">

<!-- General packages -->
	<link href="milesian.css" rel="stylesheet"/>
	<script type="text/javascript" src="CBCCE.js"></script>
	<script type="text/javascript" src="MilesianAlertMsg.js"></script>
	<script type="text/javascript" src="MilesianDateProperties.js"></script>
	<script type="text/javascript" src="JulianDateProperties.js"></script>
	<script type="text/javascript" src="RealTZmsOffset.js"></script>

	<script type="text/javascript" src="milesianMonthNamesString.js"></script>
	<script type="text/javascript" src="UnicodeBasic.js"></script>
	<script type="text/javascript" src="UnicodeMilesianFormat.js"></script>
	<script type="text/javascript" src="UnicodeJulianFormat.js"></script>

<!-- Specific for this page -->
	<script type="text/javascript" src="UnicodeTester.js"></script>	

	<title>Test calendriers Unicode</title>
<meta name="viewport" content="width=device-width">	
</head>
<body class="centered" onload="setDateToNow();">
<section class="centered"><h1 class="milesianhead">Expression de date et calendriers Unicode</h1>
<p class="milesianhead">Démonstration et test des formats d'affichage de date et d'heure
selon Unicode, avec application&nbsp;:</p>
<ul class="milesianhead">
	<li>au calendrier Unicode sélectionné,</li>
	<li>au calendrier Unicode ISO8601,</li>
	<li>au calendrier julien avec affichage conditionnel de l'ère,</li>
	<li>au calendrier milésien.</li>
</ul>
<p class="milesianhead">(!) signale une erreur manifeste de représentation.</p>
</section>

<div class="panel">
<section class="centered autoscroll"><h2 class="milesianhead">Fuseau, heure, date</h2>
	<table class="centered">
		<form name="TZmode" autocomplete="off" method="post" action="javascript:setDisplay();">
			<tr><th colspan="2">Mode&nbsp;: </th>
				<td colspan="4">
					<select name="TZcontrol" size="1" class="centered">
					<option value="UTC">UTC</option>
					<option value="TZ" selected>Fuseau système</option>
					<option value="Fixed">Décalage fixe</option>
					</select></td>
			</tr>
			<tr>
				<th>Décalage&nbsp;: </th> 
				<td><select name="TZOffsetSign" class="centered" size="2">
				<option value="1">+</option>
				<option value="-1">-</option>
				</select> </td>
				<td><input name="TZOffset" type="number" min="0" max="1500" class="centered yearnum"></td>
				<td>mn</td>
				<td><input name="TZOffsetSec" type="number" class="centered daynum"></td>
				<td>s</td>
				<td><button class="textline">Ok</button></td>
			</tr>
			<tr>
				<th colspan="2">Décalage système&nbsp;: </th>
				<td id="sysTZoffset" colspan="1"></td><td>mn</td>
			</tr>
		</form>
	</table>
<script type="text/javascript">
function calcTime() { // Here the hours are deemed local hours
	var hours = Math.round (document.time.hours.value), mins = Math.round (document.time.mins.value), secs = Math.round (document.time.secs.value);
	if (isNaN(hours) || isNaN (mins) || isNaN (secs)) 
		alert (milesianAlertMsg("invalidDate") + '"' + document.time.hours.value + '" "' + document.time.mins.value + '" "' + document.time.secs.value + '"')
	 else {
	  let testDate = new Date (targetDate.valueOf());
	  switch (TZSettings.mode) {
		case "TZ" : testDate.setHours(hours, mins, secs, 0); break;
		case "UTC" : testDate.setUTCHours(hours, mins, secs, 0); break;
		case "Fixed" : 
			testDate.setUTCTimeFromMilesian (document.milesian.year.value, document.milesian.monthname.value, document.milesian.day.value);
			testDate.setUTCHours(hours, mins, secs, 0); 
			testDate.setTime(testDate.getTime() + TZSettings.msoffset);
		}
		if (isNaN(testDate.valueOf())) alert (milesianAlertMsg("outOfRange"))
		else {
			targetDate = new Date (testDate.valueOf());
			setDisplay();
		}
	}
}
</script>
	<table class="centered">
	  <tr> 
		<form name="time" method="post" autocomplete="off" action="javascript:calcTime();">
		 <th>Heure du mode&nbsp;: </th>
		 <td><input name="hours" type="number" min="0" max="23" class="centered daynum">h</td>
		 <td><input name="mins" type="number" min="0" max="59" class="centered daynum">mn</td>
		 <td><input name="secs" type="number" min="0" max="59" class="centered daynum">s</td>
		 <td><button class="textline">Ok</button></td>	
		</form>
	  </tr>
	</table>
<script type="text/javascript">
function setDateToNow(){ // Self explanatory
    targetDate = new Date(); // set new Date object.
	setDisplay ();
}
function setUTCHoursFixed (UTChours=0) { // set UTC time to the hours specified.
	if (typeof UTChours == undefined)  UTChours = document.UTCset.Compute.value;
	let testDate = new Date (targetDate.valueOf());
	testDate.setUTCHours(UTChours, 0, 0, 0);
	if (isNaN(testDate.valueOf())) alert (milesianAlertMsg("outOfRange"))
	else {
		targetDate = new Date (testDate.valueOf());
		setDisplay();
	}
}
</script>
	 <table class="centered"> <tr>
		<th>UTC :</th>
		 <td id="UTCdate"></td>
		 <td id="UTCtime"></td>
		<td colspan=4><button class="textline" type="button" name="Now" onclick="javascript:setDateToNow();">Maintenant</button></td>
	  </tr> </table>

	  <table class="centered">
	  <tr>
		<th>Cette date à UTC</th>
		<td><button class="textline" type="button" name="0h" onclick="javascript:setUTCHoursFixed(0)";>0h</button></td>
		<td><button class="textline" type="button" name="12h" onclick="javascript:setUTCHoursFixed(12)";>12h</button></td>
	  </tr>
	 </table>

<script type="text/javascript">
var addedTime = 60; //Global variable, time to add or substract, in decimal seconds.
function changeAddTime() {
	let secs = +document.timeShift.shift.value; 
	if (isNaN(secs) || secs <= 0) 
		alert (milesianAlertMsg("invalidInput"))
	else
		{ 
		addedTime = secs; // Global variable updated
		document.timeShift.shift.value = secs; // Confirm changed value
		}
	}

function addTime (sign = 1) { // addedTime seconds is added or subtracted to or from the Timestamp.
	changeAddTime();	// Force a valid value in field
	let testDate = new Date(targetDate.valueOf());
	testDate.setTime (testDate.getTime()+sign*addedTime*Chronos.SECOND_UNIT);
	if (isNaN(testDate.valueOf())) alert (milesianAlertMsg("outOfRange"))
	else {
		targetDate = new Date (testDate.valueOf());
		setDisplay();
	}
}
</script>	 
	<table class="centered"> 
	  <tr>
		<form name="timeShift" method="post" action="javascript:changeAddTime();">
		<td>+/- secondes</td>
		<td><button type="button" class="textline symbol" onclick="javascript:addTime(-1);">-</button></td>
		<td><input name="shift" type="number" value="60" min="0" class="centered yearnum"></td>
		<td><button type="button" class="textline symbol" onclick="javascript:addTime(1);">+</button></td>
		</form>
	  </tr>
	</table>

<script type="text/javascript">
function calcMilesian() {
	var 
	 day =  Math.round (document.milesian.day.value),
	 month = document.milesian.monthname.value,
	 year =  Math.round (document.milesian.year.value);
	if	( isNaN(day)  || isNaN (year ))
		alert (milesianAlertMsg("invalidDate") + '"' + document.milesian.day.value + '" "' + document.milesian.year.value + '"')
	else {
	  let testDate = new Date (targetDate.valueOf());
	  switch (TZSettings.mode) {
		case "TZ": testDate.setTimeFromMilesian (year, month, day); // Set date object from milesian date indication, without changing time-in-the-day.
			break;
		case "UTC" : testDate.setUTCTimeFromMilesian (year, month, day);
			break;
		case "Fixed" : 	
			let shiftDate = new Date (targetDate.getTime() - TZSettings.msoffset);	// The shifted date, to be changed.
			shiftDate.setUTCTimeFromMilesian (year, month, day); 
			testDate.setTime(shiftDate.getTime() + TZSettings.msoffset);
		}
		if (isNaN(testDate.valueOf())) alert (milesianAlertMsg("outOfRange"))
		else 
			// Here, no control of date validity, leave JS recompute the date if day is out of bounds
			targetDate = new Date (testDate.valueOf());
			setDisplay();
		}
}
</script>
	<table class="centered">
       <tr>
        <th>Jour</th>
        <th>Quant.</th>
        <th>Mois</th>
        <th>Année</th>
        <th> </th>
      </tr>
      <tr>
	    <form name="milesian" method="post" action="javascript:calcMilesian();">
        <td><input name="dayofweek" type="text" class="centered" size="12" disabled="disabled" /> </td>
        <td><input name="day" type="number" min="1" max="31" class="centered daynum"> </td>
        <td>
        <select name="monthname" size="1" class="centered">
		<option value="0">1m</option>
        <option value="1">2m</option>
        <option value="2">3m</option>
        <option value="3">4m</option>
        <option value="4">5m</option>
        <option value="5">6m</option>
        <option value="6">7m</option>
        <option value="7">8m</option>
        <option value="8">9m</option>
        <option value="9">10m</option>
        <option value="10">11m</option>
        <option value="11">12m</option>
		</select> </td>
        <td><input name="year" type="number" class="centered yearnum"> </td>
        <td><button class="textline">Ok</button></td>
		</form>
      </tr>
   </table>
<script type="text/javascript">
var 
	dayOffset = 1; // Days (decimal) to add or substract
// no setDateToToday
function changeDayOffset () { 
	let days = +document.control.shift.value;
	if (isNaN(days) || days < 0) {
		alert (milesianAlertMsg("invalidInput"));
		// clockRun(0);
		}
	else 
	{ 
		dayOffset = days; // Global variable updated
		document.control.shift.value = days; // Confirm changed value
	}
}
function setDayOffset (sign=1) {
	changeDayOffset();	// Force a valid value in field
	let testDate = new Date(targetDate.valueOf());
	testDate.setTime (testDate.getTime()+sign*dayOffset*Chronos.DAY_UNIT);
	if (isNaN(testDate.valueOf())) { 
		alert (milesianAlertMsg("outOfRange"));
		// clockRun(0);
		}
	else {
		targetDate = new Date (testDate.valueOf());
		setDisplay();
	}
}
// No clock movement function
</script>
<table class="centered">
  <tr>
	<td><button class="textline" type="button" onclick="javascript:setDateToNow();";>Maintenant</button></td>
	<form name="control" method="post" action="javascript:changeDayOffset();">
		<th>+/- jours&nbsp;: </th>
		<td><button type="button" class="textline symbol" onclick="javascript:setDayOffset(-1);">-</button></td>
		<td><input name="shift" type="number" value="1" min="0" step="any" class="centered yearnum"></td> 
		<td><button type="button" class="textline symbol" onclick="javascript:setDayOffset(+1);">+</button></td>
	</form>
  </tr>
</table>
</section>
<section class="centered"><h3 class="milesianhead">Liens utiles</h3>
  <table class="centered">
	<tr><td><a target="_blank" href="http://www.iana.org/assignments/language-subtag-registry/language-subtag-registry">Codes langues Unicode</a></td></tr>
	<tr><td><a target="_blank" href="http://twiki.org/cgi-bin/xtra/tzdatepick.html">Codes zones horaires</a></td></tr>
  </table>
</section>
</div>

<section class="panel centered autoscroll"><h2 class="milesianhead">Options de présentation</h2>
	<form name="LocaleOptions" method="post" action="javascript:putStringOnOptions();">
	 <table class="centered"> 
	   <tr>
		<th>Calendrier&nbsp;: </th>
		<td>
			<select name="Calendar" size="1" class="centered">
			<option value="">par défaut</option>
			<option value="buddhist">bouddhiste Thaï</option>
			<option value="chinese">chinois luni-solaire</option>
			<option value="coptic">copte</option>
			<option value="dangi">coréen traditionnel dangi</option>
			<option value="ethioaa">éthiopien Amete Alem (5493 BC) </option>
			<option value="ethiopic">éthiopien Amete Mihret (8 AD)</option>
			<option value="gregory">grégorien</option>
			<option value="hebrew">hébraïque</option>
			<option value="indian">indien moderne</option>
			<option value="islamic">islamique standard</option>
			<option value="islamic-umalqura">islamique Umm al-Qura</option>
			<option value="islamic-tbla">islamique tabulaire astronomique</option>
			<option value="islamic-civil">islamique tabulaire civil</option>
			<option value="islamic-rgsa">islamique, Arabie saoudite</option>
			<option value="iso8601">ISO 8601 (grégorien normalisé)</option>
			<option value="japanese">japonais impérial</option>
			<option value="persian">persan</option>
			<option value="roc">chinois de république populaire</option>
			</select> 
		</td>
	   </tr>
	   <tr>
		<th>Extension Unicode&nbsp;: </th>
		<td><input name="UnicodeExt" type="text" class="centered"></td>
	   </tr>
	   <tr>
	    <td>Calendrier effectif&nbsp;: </td>
	    <td><input name="Ecalend" type="text" disabled="disabled" class="centered"></td>
	   </tr>
	   <tr>
		<th>Code langue-pays&nbsp;: </th>
		<td><input name="Locale" autocomplete="language" type="text" class="centered" size="30"> </td>
	   </tr>
	   <tr>
		<td>Code effectif&nbsp;: </td><td colspan="3"><input name="Elocale" type="text" disabled="disabled" class="centered" size="30"></td>
	   </tr>
		<tr><th>Fuseau horaire&nbsp;: </th>
		<td><input name="TimeZone" type="text" autocomplete="country" class="centered" size="30"> </td>
		</tr>
		<tr><td>Fuseau effectif&nbsp;: </td><td><input name="ETimeZone" type="text" disabled="disabled" class="centered" size="30"></td></tr>
		</table>
	 <table class="centered">
	   <tr>
		<th>Quantième</th><th>Mois</th><th>Année</th>
	   </tr>
	   <tr>
		<td><select name="Day" class="centered" size="1">
			<option value="">absent</option>
			<option value="numeric" selected>numérique</option>
			<option value="2-digit">2 chiffres</option>
			</select></td>
		<td><select name="Month" class="centered" size="1">
			<option value="">absent</option>
			<option value="numeric">numérique</option>
			<option value="2-digit">2 chiffres</option>
			<option value="narrow">étroit</option>
			<option value="short">court</option>
			<option value="long" selected>long</option>
			</select></td>
		<td><select name="Year" class="centered" size="1">
			<option value="">absent</option>
			<option value="numeric" selected>numérique</option>
			<option value="2-digit">2 chiffres</option>
			</select></td>
	   </tr>
	   <tr>
		<th>Heure</th><th>Minute</th><th>Seconde</th>
	   </tr>
	   <tr>
		<td><select name="Hour" class="centered" size="1">
			<option value="">absent</option>
			<option value="numeric" selected>numérique</option>
			<option value="2-digit">2 chiffres</option>
			</select></td>
		<td><select name="Minute" class="centered" size="1">
			<option value="">absent</option>
			<option value="numeric" selected>numérique</option>
			<option value="2-digit">2 chiffres</option>
			</select></td>
		<td><select name="Second" class="centered" size="1">
			<option value="">absent</option>
			<option value="numeric" selected>numérique</option>
			<option value="2-digit">2 chiffres</option>
			</select></td>
	   </tr>
	<tr> 
		<th>Jour semaine</th><th>Ère</th><th>Cycle horaire</th>
	</tr> 
	<tr>
		<td><select name="Weekday" class="centered" size="1">
			<option value="">absent</option>
			<option value="narrow">étroit</option>
			<option value="short">court</option>
			<option value="long" selected>long</option>
			</select></td>
		<td><select name="Era" class="centered" size="1">
			<option value="" selected>absent</option>
			<option value="narrow">étroit</option>
			<option value="short">court</option>
			<option value="long">long</option>
			</select></td>
		<td><select name="Hour12" size="1" class="centered">
			<option value="" selected>usage local</option>
			<option value="true">12h</option>
			<option value="false">24h</option>
			</select></td>
	</tr>
	<tr>
		<th>&nbsp;</th><th>Ère actuelle</th><th>Fuseau</th>
	</tr>
	<tr>
		<td>&nbsp;</td>
		<td><select name="MaskPresentEra" class="centered" size="1">
			<option value="exceptCurrent">masquée</option>
			<option value="allEra">affichée</option>
			</select>
		</td>
		<td><select name="TimeZoneName" class="centered" size="1">
			<option value="" selected>absent</option>
			<option value="short">court</option>
			<option value="long">long</option>
			</select></td>
	</tr>
<!-- options de formatage effectives -->
	<tr><th colspan="3">Options de format effectives</th></tr>
	   <tr>	<th>Quantième</th><th>Mois</th><th>Année</th></tr>
	<tr>
		<td><input name="Eday" type="text" disabled="disabled" class="centered"></td>
		<td><input name="Emonth" type="text" disabled="disabled" class="centered"></td>
		<td><input name="Eyear" type="text" disabled="disabled" class="centered"></td>
	</tr>
		<tr><th>Heure</th><th>Minute</th><th>Seconde</th></tr>
	<tr>
		<td><input name="Ehour" type="text" disabled="disabled" class="centered"></td>
		<td><input name="Eminute" type="text" disabled="disabled" class="centered"></td>
		<td><input name="Esecond" type="text" disabled="disabled" class="centered"></td>
	</tr>
		<tr><th>Jour semaine</th><th>Ère</th><th>12 heures</th></tr>
	<tr>
		<td><input name="Eweekday" type="text" disabled="disabled" class="centered"></td>
		<td><input name="Eera" type="text" disabled="disabled" class="centered"></td>
		<td><input name="Ehour12" type="text" disabled="disabled" class="centered"></td>
	</tr>
	</table>
	<table class="centered">
		<tr><th>Numération</th><th>Affichage fuseau</th></tr>
	  <tr>
		<td><input name="Enum" type="text" disabled="disabled" class="centered"></td>
		<td><input name="EtimeZoneName" type="text" disabled="disabled" class="centered"></td>
	  </tr>
<!-- fin des options de formatage effectives -->
	<tr>
		<td><button class="textline" type="reset">Réinit</button></td>
		<td><button class="textline" >Ok</button></td> <td></td>
	</tr>
   </table>
  </form> 
</section>

<section class="panel centered autoscroll"><h2 class="milesianhead">Expressions de date</h2>
   <table class="centered">
		<tr><th>Unicode&nbsp;: </th><td id="Ustring"></td></tr>
		<tr><th>ISO8601&nbsp;: </th><td id="Gstring"></td></tr>
		<tr><th>Julien&nbsp;: </th><td id="Jstring"></td></tr>
		<tr><th>Milésien&nbsp;: </th><td id="Mstring"></td></tr>
	</table>
</section>

<footer class="centered">
 <p>© 2017-2020 <a href="http://www.calendriermilesien.org">www.calendriermilesien.org</a></p>
</footer>
</body>
</html>
